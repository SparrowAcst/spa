{"appWidgets":[],"pages":[{"layout":"flex","sections":[{"align":"justify-center","holders":[{"name":"default","width":11}]}],"holders":{"default":{"widgets":[{"type":"dps-suite-widget","name":"noname","icon":"mdi-card-text-outline","options":{"widget":{"visible":true}},"scripts":[{"name":"TEST1","script":"\n/**\n **\n **     DATA PROCESSING SCRIPT: TEST1\n **     SERVICE: \n **\n **/\n \n <?javascript\n    $scope.options = {\n         db: {\n                url: \"mongodb://localhost:27017\",\n                // url: \"mongodb+srv://jace:jace@jace.llb8spm.mongodb.net?retryWrites=true&w=majority\",\n                name: \"sparrow\",\n                labelingCollection: \"harvest1\",\n                metadataCollection: \"harvest1-metadata\",\n                historyCollection: \"harvest1-history\",\n                grantCollection: \"app-grant\"\n            }\n    }\n    $scope.script = [[\n        {$from:\"harvest1\"},\n        {$limit:1}\n        ]]\n    // $scope.script = [\n    //     [\n    //         {\n    //             $from: \"harvest1\"\n    //         },\n    //         {\n    //             $match: {\n    //                 label: \"Gender\",\n    //                 operation: \"$not-in\",\n    //                 value: [\"Male\"]\n    //             }\n    //         },\n    //         {\n    //             $limit: 5\n    //         },\n    //         {\n    //             $out: \"TO-FEMALE\"\n    //         }\n    //     ],\n    //     [\n    //         {\n    //             $from: \"harvest1\"\n    //         },\n    //         {\n    //             $match: {\n    //                 label: \"Gender\",\n    //                 operation: \"$in\",\n    //                 value: [\"Male\"]\n    //             }\n    //         },\n    //         {\n    //             $limit: 6\n    //         },\n    //         {\n    //             $out: \"TO-MALE\"\n    //         }\n    //     ],\n    //     [\n    //         {\n    //             $from: \"TO-FEMALE\"\n    //         },\n    //         {\n    //             $union: \"TO-MALE\"\n    //         },    \n    //         {\n    //             $project:[\n    //                 \"id\",\n    //                 \"Gender\"\n    //             ]\n    //         }\n    //     ],\n        \n    // ]\n ?>\n\n\nservice.mongodb.script(\n    at: <? $scope.options.db.url ?>,\n    db: <? $scope.options.db.name ?>,\n    script: <? $scope.script ?> \n)\n"}],"data":{"source":"embedded","embedded":"<h2 color=\"#eee\"><center>not configured<center></h2><p>Use options dialog for configure this widget</p>","script":""},"id":"jo6bytsnju","activated":false}]}},"title":"home","url":"http://localhost:8080/design/TEST%20MONGO#/"},{"layout":"flex","sections":[{"align":"justify-start","holders":[{"name":"default","width":12}]}],"holders":{"default":{"widgets":[]}},"id":"b","title":"b"},{"layout":"with-navigation-drawer","sections":[{"id":"default section","type":"section","align":"justify-start","holders":[{"name":"default","width":12}]}],"holders":{"default":{"widgets":[]},"h-bar":{"widgets":[]},"t-bar":{"widgets":[]}},"id":"list-group","title":"list-group","url":"http://localhost:8080/design/TEST%20MONGO#/list-group"},{"layout":"monitor","sections":[{"id":"default section","type":"section","align":"justify-start","holders":[{"name":"default","width":12}]},{"id":"qbluxwb1hp","type":"section","align":"justify-start","holders":[{"name":"r2uxttl92x","width":12}]},{"id":"nhjrvywosye","type":"section","align":"justify-start","holders":[{"name":"rujgoev5vsm","width":12}]},{"id":"y94d6e9ms9s","type":"section","align":"justify-start","holders":[{"name":"2060ine4x48","width":12}]},{"id":"xqiyhobzua","type":"section","align":"justify-start","holders":[{"name":"cpyl468daj","width":12}]}],"holders":{"default":{"widgets":[{"type":"tab-bar-widget","name":"noname","icon":"mdi-page-layout-header","options":{"widget":{"visible":true},"style":"widget-style {\n    margin: 5px 5px 0 5px;\n  }"},"data":{"source":"embedded","embedded":{"decoration":{"color":"secondary","bgColor":"#ffffff","sliderColor":"primary lighten-3","sliderSize":"3","activeClass":"active","classes":"subtitle-1","right":false,"left":true,"vertical":false},"tabs":[{"title":"Query Builder","event":"select-tab"},{"title":"Data","event":"select-tab"},{"title":"Report","event":"select-tab"}]},"script":""},"id":"qxcemhvptf","activated":false},{"type":"input-group-widget","name":"noname","icon":"mdi-card-bulleted-outline","options":{"widget":{"visible":true,"height":300},"style":"\n  widget-style {\n    width: 40em;\n    float: right;\n    margin-top: -2.2em;\n\n  }\n"},"data":{"source":"embedded","embedded":{"rows":[{"cols":[{"type":"text","data":{"value":"{{options.data.name}}","label":"Query Name"},"decoration":{"outlined":true,"dense":true,"classes":"flex xs6 mr-1"}},{"type":"menu","data":{"items":[{"title":"Save Query","event":"save-cmd","icon":"mdi-table-large-plus"},{"title":"Drop Query","event":"drop-cmd","icon":"mdi-table-large-remove"},{"title":"Export Data","event":"drop-cmd","icon":"mdi-table-large"}]},"decoration":{"icon":"mdi-chevron-down","iconOnly":true,"color":"secondary lighten-2","classes":"mr-1"}}],"decoration":{"classes":"d-flex align-center justify-end"}}]},"script":""},"id":"lw71jd7mf","activated":false}]},"h-bar":{"widgets":[{"type":"input-group-widget","name":"noname","icon":"mdi-card-bulleted-outline","options":{"widget":{"visible":true,"height":300}},"data":{"source":"embedded","embedded":{"rows":[{"cols":[{"type":"note","data":{"value":"Heart Harvest Reports"}},{"type":"spacer"},{"type":"navbarButton"}],"decoration":{"classes":"d-flex align-center headline px-1 py-1 mb-1 primary--text"}},{"cols":[{"type":"note","data":{"value":"${user.role}"},"decoration":{"classes":"subtitle-2"}},{"type":"avatar","decoration":{"src":"${user.photo}","icon":"mdi-account-circle-outline","style":"padding:0;","size":32,"title":"${user.altname}","subTitle":"${user.email}"}}],"decoration":{"classes":"subtitle-1 px-2 mb-1"}}]},"script":""},"id":"fes6b6ph94","activated":false},{"type":"input-group-widget","name":"noname","icon":"mdi-card-bulleted-outline","options":{"widget":{"visible":true,"height":300}},"data":{"source":"embedded","embedded":{"rows":[{"cols":[{"type":"note","data":{"value":"Queries"}}],"decoration":{"classes":"d-flex align-center title px-1 py-1 mb-1"}}]},"script":""},"id":"ny5uc9xt2j","activated":false},{"type":"html-widget","name":"noname","icon":"mdi-language-html5","options":{"widget":{"visible":true}},"data":{"source":"embedded","embedded":"<style>\n    .error-message {\n        border: 1px solid;\n        background: #fff3e0;\n    }\n    .v-input__control {\n        line-height:1.1;\n    }\n    .v-input--selection-controls__input {\n        height: 10px;\n    }\n    .v-input--selection-controls__ripple, \n    .v-input--selection-controls.v-input--dense .v-input--selection-controls__ripple\n    {\n        width: 21px;\n        height: 21px;\n        left: -5px;\n        top: calc(50% - 18px) !important;\n    }\n    .v-textarea textarea {\n     line-height:1.1;   \n    }\n    .v-text-field > .v-input__control > .v-input__slot > .v-text-field__slot {\n        font-size: 14px;\n        \n    }    \n    .v-input--selection-controls__input .v-icon {\n    width: 100%;\n    font-size: 20px;\n    }\n    \n    \n    .q-title {\n        padding: 2px 0;\n        background: #efefef;\n    }\n    \n    .v-label {\n        font-size: 14px;\n    }\n    \n    .framed {\n        margin: 10px 0 0 2px;\n    }\n    \n    .note-border {\n        padding: 0 2px;\n        margin: 0 5px;\n        border-bottom: 1px solid #dedede;\n        line-height: 1 !important;\n    }\n    .note-dense{\n        line-height: 1 !important;\n    }\n    .widget-hidden {\n        background: red;\n        display:none;\n    }\n    \n    \n    .markdown-body p, .markdown-body blockquote, .markdown-body ul, .markdown-body ol, .markdown-body dl, .markdown-body table, .markdown-body pre {\n        margin-top: 0;\n        margin-bottom: 5px;\n        line-height: 1.1;\n    }\n    \n    .markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 {\n        margin-top: 10px;\n        margin-bottom: 12px;\n        font-weight: 600;\n        line-height: 1.25;\n    }\n    \n    v-text-field--filled.v-input--dense.v-text-field--outlined.v-text-field--filled>.v-input__control>.v-input__slot, .v-text-field--filled.v-input--dense.v-text-field--outlined>.v-input__control>.v-input__slot, .v-text-field--filled.v-input--dense.v-text-field--single-line>.v-input__control>.v-input__slot, .v-text-field--full-width.v-input--dense.v-text-field--outlined.v-text-field--filled>.v-input__control>.v-input__slot, .v-text-field--full-width.v-input--dense.v-text-field--outlined>.v-input__control>.v-input__slot, .v-text-field--full-width.v-input--dense.v-text-field--single-line>.v-input__control>.v-input__slot, .v-text-field--outlined.v-input--dense.v-text-field--outlined.v-text-field--filled>.v-input__control>.v-input__slot, .v-text-field--outlined.v-input--dense.v-text-field--outlined>.v-input__control>.v-input__slot, .v-text-field--outlined.v-input--dense.v-text-field--single-line>.v-input__control>.v-input__slot {\n        min-height: inherit;\n    }\n    .v-text-field--outlined.v-input--dense .v-label {\n        top: 7px;\n    }\n    \n    .v-select.v-text-field--outlined:not(.v-text-field--single-line).v-input--dense .v-select__selections {\n        padding: 0;\n    }\n    \n    outlined .v-input__append-inner, .v-text-field--enclosed.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__append-outer, .v-text-field--enclosed.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__prepend-inner, .v-text-field--enclosed.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__prepend-outer, .v-text-field--full-width.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__append-inner, .v-text-field--full-width.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__append-outer, .v-text-field--full-width.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__prepend-inner, .v-text-field--full-width.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__prepend-outer {\n        margin-top: 5px;\n    }\n    \n    .v-text-field--enclosed.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__append-inner, .v-text-field--enclosed.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__append-outer, .v-text-field--enclosed.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__prepend-inner, .v-text-field--enclosed.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__prepend-outer, .v-text-field--full-width.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__append-inner, .v-text-field--full-width.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__append-outer, .v-text-field--full-width.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__prepend-inner, .v-text-field--full-width.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__prepend-outer {\n        margin-top: 5px !important;\n    }\n</style>","script":""},"id":"419542cu5tr","activated":false},{"type":"html-widget","name":"noname_clone_lxtaz1w671","icon":"mdi-language-html5","options":{"widget":{"visible":true}},"data":{"source":"embedded","embedded":"<style>\n    .error-message {\n        border: 1px solid;\n        background: #fff3e0;\n    }\n    .v-input__control {\n        line-height:1.1;\n    }\n    .v-input--selection-controls__input {\n        height: 10px;\n    }\n    .v-input--selection-controls__ripple, \n    .v-input--selection-controls.v-input--dense .v-input--selection-controls__ripple\n    {\n        width: 21px;\n        height: 21px;\n        left: -5px;\n        top: calc(50% - 18px) !important;\n    }\n    .v-textarea textarea {\n     line-height:1.1;   \n    }\n    .v-text-field > .v-input__control > .v-input__slot > .v-text-field__slot {\n        font-size: 14px;\n        \n    }    \n    .v-input--selection-controls__input .v-icon {\n    width: 100%;\n    font-size: 20px;\n    }\n    \n    \n    .q-title {\n        padding: 2px 0;\n        background: #efefef;\n    }\n    \n    .v-label {\n        font-size: 14px;\n    }\n    \n    .framed {\n        margin: 10px 0 0 2px;\n    }\n    \n    .note-border {\n        padding: 0 2px;\n        margin: 0 5px;\n        border-bottom: 1px solid #dedede;\n        line-height: 1 !important;\n    }\n    .note-dense{\n        line-height: 1 !important;\n    }\n    .widget-hidden {\n        background: red;\n        display:none;\n    }\n    \n    \n    .markdown-body p, .markdown-body blockquote, .markdown-body ul, .markdown-body ol, .markdown-body dl, .markdown-body table, .markdown-body pre {\n        margin-top: 0;\n        margin-bottom: 5px;\n        line-height: 1.1;\n    }\n    \n    .markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 {\n        margin-top: 10px;\n        margin-bottom: 12px;\n        font-weight: 600;\n        line-height: 1.25;\n    }\n    \n    v-text-field--filled.v-input--dense.v-text-field--outlined.v-text-field--filled>.v-input__control>.v-input__slot, .v-text-field--filled.v-input--dense.v-text-field--outlined>.v-input__control>.v-input__slot, .v-text-field--filled.v-input--dense.v-text-field--single-line>.v-input__control>.v-input__slot, .v-text-field--full-width.v-input--dense.v-text-field--outlined.v-text-field--filled>.v-input__control>.v-input__slot, .v-text-field--full-width.v-input--dense.v-text-field--outlined>.v-input__control>.v-input__slot, .v-text-field--full-width.v-input--dense.v-text-field--single-line>.v-input__control>.v-input__slot, .v-text-field--outlined.v-input--dense.v-text-field--outlined.v-text-field--filled>.v-input__control>.v-input__slot, .v-text-field--outlined.v-input--dense.v-text-field--outlined>.v-input__control>.v-input__slot, .v-text-field--outlined.v-input--dense.v-text-field--single-line>.v-input__control>.v-input__slot {\n        min-height: inherit;\n    }\n    .v-text-field--outlined.v-input--dense .v-label {\n        top: 7px;\n    }\n    \n    .v-select.v-text-field--outlined:not(.v-text-field--single-line).v-input--dense .v-select__selections {\n        padding: 0;\n    }\n    \n    outlined .v-input__append-inner, .v-text-field--enclosed.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__append-outer, .v-text-field--enclosed.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__prepend-inner, .v-text-field--enclosed.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__prepend-outer, .v-text-field--full-width.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__append-inner, .v-text-field--full-width.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__append-outer, .v-text-field--full-width.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__prepend-inner, .v-text-field--full-width.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__prepend-outer {\n        margin-top: 5px;\n    }\n    \n    .v-text-field--enclosed.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__append-inner, .v-text-field--enclosed.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__append-outer, .v-text-field--enclosed.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__prepend-inner, .v-text-field--enclosed.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__prepend-outer, .v-text-field--full-width.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__append-inner, .v-text-field--full-width.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__append-outer, .v-text-field--full-width.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__prepend-inner, .v-text-field--full-width.v-input--dense:not(.v-text-field--solo).v-text-field--outlined .v-input__prepend-outer {\n        margin-top: 5px !important;\n    }\n</style>","script":""},"id":"lxtaz1w671","activated":false}]},"t-bar":{"widgets":[{"type":"mediator-widget","name":"noname","icon":"mdi-language-javascript","options":{"widget":{"visible":true}},"data":{"script":"selectSections(\"xqiyhobzua\").hide()\n\n\n// const updateWidgets = () => {\n//     let instances = [selectWidgets([\n//         \"mkobjn8slf\"\n//         // \"1imgqsalrki\",\n//         // \"gijnpvdqwzi\",\n//         // \"eqyv5bh3dr\",\n//         // \"xhp8yakkw8r\", //out\n//         // \"gbkd9b357ve\", // unique,\n//         // \"hz3w7raswo\", // project\n        \n//         ])]\n        \n//         setTimeout(() => {\n//             instances.forEach( d => {\n//                  if(d) d.update({data: window.app}, {override:\"options.data\"})\n//             })    \n//         }, 10)\n// }\n\n \nthis.on({\n    event: \"start\",\n    callback: () => {\n        window.app.availableCollections = [\"harvest1\"]\n        window.app.query = [\n            [{\n                $from:{}\n            }]\n        ]  \n        \n//         [\n//     [\n//     \t{\n//     \t  \t$from: \"Harvest\"\n//     \t},\n//     \t{\n//     \t    $match: {}\n//     \t},\n//     \t{\n//     \t    $union:\"harvest1\"\n//     \t},\n//     \t{\n//     \t    $limit: 5\n//     \t},\n//     \t{\n//     \t    $out:\"B\"\n//     \t}\n//     ],\n//     [\n//     \t{\n//     \t  \t$from: \"B\"\n//     \t},\n//     \t{\n//     \t    $sample: 3\n//     \t},\n//     \t{\n//     \t $minus: \"B\"   \n//     \t}\n//     ],\n//     [\n//     \t{\n//     \t  \t$from: \"C\"\n//     \t},\n//     \t{\n//     \t    $intersect:\"harvest1\"\n//     \t}\n//     ],\n// ]  \n        \n    // updateWidgets()\n    \n        // console.log(selectWidgets(\"3zu6u7reokw\"))\n        // selectWidgets(\"3zu6u7reokw\").getInstance().setData(window.app.query)        \n        // selectWidgets(\"c69bkzgu598\").getInstance().setData({})        \n        \n    \n    \n    /////////////////////////////////////////////////////////////////////////\n\nwindow.app.availableOperations = {\n\t\"number\": [\"==\",\"!=\",\"<\",\"<=\",\">\",\">=\"],\n\t\"text\": [\"==\", \"!=\", \"$starts-with\", \"$ends-with\", \"$contains-str\"],\n\t\"oneOf\": [\"$in\", \"$not-in\"],\n\t\"manyOf\":[\"$contains-all\", \"$not-contains-all\", \"$contains-any\", \"$not-contains-any\", \"$is\"]\n}\t\n\nwindow.app.getOperations = (label) => {\n    let meta = window.app.metadata[label]\n    if(meta){\n        return window.app.availableOperations[meta.type]\n    } else {\n        return []\n    }\n}\n\nwindow.app.getLabelType = (label) => {\n    console.log(\"window.app.getLabelType\", label)\n    let meta = window.app.metadata[label]\n    if(meta){\n        return meta.type\n    } else {\n        return null\n    }\n}\n\nwindow.app.getValues = (label) => {\n    let meta = window.app.metadata[label]\n    if(meta){\n        return meta.values\n    } else {\n        return []\n    }\n}\n\nwindow.app.labelRequired = statement => {\n    return (!statement.label) ? \"inherit\" : \"none\"\n}    \n\nwindow.app.operationRequired = statement => {\n    if(window.app.labelRequired(statement) == \"inherit\") return \"none\" \n    return (!statement.operation) ? \"inherit\" : \"none\"\n}    \n\nwindow.app.valueRequired = statement => {\n    if(window.app.labelRequired(statement) == \"inherit\" || window.app.operationRequired(statement) == \"inherit\" ) return \"none\" \n    return (!statement.value || statement.value.length == 0) ? \"inherit\" : \"none\"\n}    \n\nwindow.app.activeMultipleValue = statement => {\n    let meta = window.app.metadata[statement.label]\n    if(meta){\n        return ([\"oneOf\",\"manyOf\"].includes(meta.type)) ? \"inherit\" : \"none\"\n    } else {\n       return \"inherit\" \n    }    \n}    \n\nwindow.app.activeSingleValue = statement => {\n    let meta = window.app.metadata[statement.label]\n    if(meta){\n        return (![\"oneOf\",\"manyOf\"].includes(meta.type)) ? \"inherit\" : \"none\"\n    } else {\n       return \"none\" \n    }    \n}    \n\n    \nlet queryBuilderWidget = selectWidgets(\"zpyh6ysue5l\")\n\nlet templates = {\n    $from: selectWidgets(\"1imgqsalrki\").getInstance().options.rows[0],\n    $union: selectWidgets(\"gijnpvdqwzi\").getInstance().options.rows[0],\n    $intersect: selectWidgets(\"eqyv5bh3dr\").getInstance().options.rows[0],\n    $minus: selectWidgets(\"ge2kfbypjg4\").getInstance().options.rows[0],\n    $unique: selectWidgets(\"gbkd9b357ve\").getInstance().options.rows[0],\n    $project: selectWidgets(\"hz3w7raswo\").getInstance().options.rows[0],\n    $out: selectWidgets(\"xhp8yakkw8r\").getInstance().options.rows[0],\n    $limit: selectWidgets(\"wrk3vumfwi\").getInstance().options.rows[0],\n    $sample: selectWidgets(\"95l4wqplwo8\").getInstance().options.rows[0],\n    $match: selectWidgets(\"mkobjn8slf\").getInstance().options.rows[0],\n}\n\nconst validId = d => /^[A-Za-z\\_]+/.test(d)\nwindow.app.validId = validId\n\nconst resolveStatement = {\n    \"$from\": (s, r)  => {\n        r = _.extend({}, r)\n        r.data.type = _.first(_.keys(s))\n        s[_.first(_.keys(s))] = (window.app.availableCollections.includes(s[_.first(_.keys(s))])) ? s[_.first(_.keys(s))] : null\n        r.cols[2].data.value = `{{options.data.query[${r.data.query}][${r.data.statement}].${_.first(_.keys(s))}}}`\n        r.cols[4].decoration.style = `\\$\\{\\`display: \\$\\{(!this.options.data.query[${r.data.query}][${r.data.statement}].${_.first(_.keys(s))}) ? \"inherit\" : \"none\"}\\`\\}`\n        r.cols[0].data.items = r.cols[0].data.items.map( d => {\n            d.data = r.data\n            return d\n        })\n        r.cols[3].data.context = r.data\n        \n        return r\n    },\n    \n    \"$union\": (s, r) => {\n        r = _.extend({}, r)\n        r.data.type = _.first(_.keys(s))\n        \n        s[_.first(_.keys(s))] = (window.app.availableCollections.includes(s[_.first(_.keys(s))])) ? s[_.first(_.keys(s))] : null\n        r.cols[2].data.value = `{{options.data.query[${r.data.query}][${r.data.statement}].${_.first(_.keys(s))}}}`\n        r.cols[4].decoration.style = `\\$\\{\\`display: \\$\\{(!this.options.data.query[${r.data.query}][${r.data.statement}].${_.first(_.keys(s))}) ? \"inherit\" : \"none\"}\\`\\}`\n        r.cols[0].data.items = r.cols[0].data.items.map( d => {\n            d.data = r.data\n            return d\n        })\n        r.cols[3].data.context = r.data\n        return r\n    },\n    \n    \"$intersect\": (s, r) => resolveStatement.$union(s, r),\n    \"$minus\": (s, r) => resolveStatement.$union(s, r),\n    \n    \"$unique\": (s, r) => {\n        r = _.extend({}, r)\n        r.data.type = _.first(_.keys(s))\n        \n        // s[_.first(_.keys(s))] = (window.app.availableCollections.includes(s[_.first(_.keys(s))])) ? s[_.first(_.keys(s))] : null\n        \n        r.cols[2].data.value = `{{options.data.query[${r.data.query}][${r.data.statement}].$unique}}`\n        r.cols[4].decoration.style = `\\$\\{\\`display: \\$\\{(!this.options.data.query[${r.data.query}][${r.data.statement}].$unique) ? \"inherit\" : \"none\"}\\`\\}`\n        r.cols[0].data.items = r.cols[0].data.items.map( d => {\n            d.data = r.data\n            return d\n        })\n        r.cols[3].data.context = r.data\n        return r\n    },\n    \n    \"$out\": (s, r) => {\n        r = _.extend({}, r)\n        r.data.type = _.first(_.keys(s))\n        \n        // s[_.first(_.keys(s))] = (window.app.availableLabels.includes(s[_.first(_.keys(s))])) ? s[_.first(_.keys(s))] : null\n        r.cols[2].data.value = `{{options.data.query[${r.data.query}][${r.data.statement}].${_.first(_.keys(s))}}}`\n        r.cols[4].decoration.style = `\\$\\{\\`display: \\$\\{(!app.validId(this.options.data.query[${r.data.query}][${r.data.statement}].$out || \"\")) ? \"inherit\" : \"none\"}\\`\\}`\n        r.cols[0].data.items = r.cols[0].data.items.map( d => {\n            d.data = r.data\n            return d\n        })\n        r.cols[3].data.context = r.data\n        return r\n    },\n    \n    \"$project\": (s, r) => {\n        r = _.extend({}, r)\n        r.data.type = _.first(_.keys(s))\n        \n        r.cols[2].data.value = `{{options.data.query[${r.data.query}][${r.data.statement}].${_.first(_.keys(s))}}}`\n        r.cols[4].decoration.style = `\\$\\{\\`display: \\$\\{(!this.options.data.query[${r.data.query}][${r.data.statement}].${_.first(_.keys(s))}.length > 0) ? \"inherit\" : \"none\"}\\`\\}`\n        r.cols[0].data.items = r.cols[0].data.items.map( d => {\n            d.data = r.data\n            return d\n        })\n        r.cols[3].data.context = r.data\n        return r\n    },\n    \n    \"$limit\": (s, r) => {\n        r = _.extend({}, r)\n        r.data.type = _.first(_.keys(s))\n        \n        r.cols[2].data.value = `{{options.data.query[${r.data.query}][${r.data.statement}].${_.first(_.keys(s))}}}`\n        r.cols[4].decoration.style = `\\$\\{\\`display: \\$\\{(Number.parseInt(this.options.data.query[${r.data.query}][${r.data.statement}].${_.first(_.keys(s))}) <= 0 || Number.isNaN(Number.parseInt(this.options.data.query[${r.data.query}][${r.data.statement}].${_.first(_.keys(s))}))) ? \"inherit\" : \"none\"}\\`\\}`\n        r.cols[0].data.items = r.cols[0].data.items.map( d => {\n            d.data = r.data\n            return d\n        })\n        r.cols[3].data.context = r.data\n        return r\n    },\n    \"$sample\": (s, r) => resolveStatement.$limit(s, r),\n    \n    \"$match\": (s, r) => {\n        r = _.extend({}, r)\n        r.data.type = _.first(_.keys(s))\n        \n        r.cols[2].data.value = `{{options.data.query[${r.data.query}][${r.data.statement}].$match.label}}`\n        r.cols[2].data.id = `${r.data.query}.${r.data.statement}`\n        \n        r.cols[3].data.value = `{{options.data.query[${r.data.query}][${r.data.statement}].$match.operation}}`\n        r.cols[3].data.items = `\\$\\{app.getOperations(this.options.data.query[${r.data.query}][${r.data.statement}].$match.label)\\}`\n        \n        r.cols[4].data.value = `{{options.data.query[${r.data.query}][${r.data.statement}].$match.value}}`\n        r.cols[4].data.items = `\\$\\{app.getValues(this.options.data.query[${r.data.query}][${r.data.statement}].$match.label)\\}`\n        r.cols[4].decoration.style = `\\$\\{\\` display: \\$\\{ app.activeMultipleValue(this.options.data.query[${r.data.query}][${r.data.statement}].$match) \\} \\`\\}`\n        \n        \n        r.cols[5].data.value = `{{options.data.query[${r.data.query}][${r.data.statement}].$match.value}}`\n        r.cols[5].decoration.style = `\\$\\{\\` display: \\$\\{ app.activeSingleValue(this.options.data.query[${r.data.query}][${r.data.statement}].$match) \\} \\`\\}`\n        \n        r.cols[6].data.context = r.data\n        \n        r.cols[7].decoration.style = `\\$\\{\\` display: \\$\\{ app.labelRequired(this.options.data.query[${r.data.query}][${r.data.statement}].$match) \\} \\`\\}`\n        r.cols[8].decoration.style = `\\$\\{\\` display: \\$\\{ app.operationRequired(this.options.data.query[${r.data.query}][${r.data.statement}].$match) \\} \\`\\}`\n        r.cols[9].decoration.style = `\\$\\{\\` display: \\$\\{ app.valueRequired(this.options.data.query[${r.data.query}][${r.data.statement}].$match) \\} \\`\\}`\n        \n        \n        r.cols[0].data.items = r.cols[0].data.items.map( d => {\n            d.data = r.data\n            return d\n        })\n        \n        return r\n    }\n}\n\n\nwindow.app.datasets = [\"harvest1\"]\n\nconst resolveAvailableCollections = () => {\n    window.app.availableCollections = window.app.datasets.map( d => d)\n    window.app.query.forEach( q => {\n        let out = q.filter(s => s.$out).map( s => s.$out)\n        window.app.availableCollections = window.app.availableCollections.concat(out)\n    })\n}\n\nconst buildQueryView = () => {\n\n    resolveAvailableCollections()\n    \n    let rows = []\n    window.app.query.forEach( (q, iq) => {\n        q.forEach( (s, is) => {\n          let r =  JSON.parse(JSON.stringify(templates[_.first(_.keys(s))]))           \n          r.data = {\n             query: iq,\n             statement: is\n          }\n          let resolved = resolveStatement[_.first(_.keys(s))](s,r) \n          rows.push(resolved)\n        })\n    })\n    queryBuilderWidget.getInstance().options.rows = rows\n    queryBuilderWidget.update({data: window.app}, {override:\"options.data\"})\n}\n\n\n\n\nthis.on({\n    event:\"set-out-collection\",\n    callback: (sender, data) => {\n        if( validId(data)){\n            resolveAvailableCollections()    \n        }\n        \n    } \n})\n\n\nthis.on({\n    event:\"apply-query\",\n    callback: () => {\n        buildQueryView()\n    } \n})\n\n\nlet prev = {}\n\nthis.on({\n    event:\"select-label\",\n    callback: (sender, data) => {\n        if(prev[sender.options.data.id] != data){\n            // console.log(\"select-label\", sender.options.data.id, data, prev[sender.options.data.id])\n            let coord = sender.options.data.id.split(\".\").map( d => Number.parseInt(d))\n            let s = window.app.query[coord[0]][coord[1]]\n            s.$match.type = window.app.getLabelType(s.$match.label)\n            // console.log(coord, s)\n            s.$match.operation = null\n            s.$match.value = null\n            \n            setTimeout(() => {\n                queryBuilderWidget.update({data: window.app}, {override:\"options.data\"})    \n            }, 10)    \n        }\n        prev[sender.options.data.id] = data\n        \n    } \n})\n\nthis.on({\n    event:\"remove-statement\",\n    callback: (sender, message) => {\n        // console.log(message)\n        switch (message.data.context.type){\n        \n            case \"$from\":\n                if(window.app.query.length > 1){\n                    window.app.query.splice(message.data.context.query, 1)\n                }\n                break\n            case \"$union\":\n            case \"$intersect\":\n            case \"$minus\":\n            case \"$unique\":\n            case \"$project\":\n            case \"$limit\":\n            case \"$sample\":\n            case \"$out\":\n            case \"$match\":\n                window.app.query[message.data.context.query].splice(message.data.context.statement, 1)\n                break\n        }        \n        \n        buildQueryView()\n    }\n})    \n\nthis.on({\n    event:\"add-statement\",\n    callback: (sender, message) => {\n        switch (message.title){\n            case \"SUBQUERY\":\n                window.app.query.splice(message.data.query+1, 0, [{$from: null}])\n                break\n            case \"UNION\":\n                window.app.query[message.data.query].splice(message.data.statement+1, 0, {$union: null})\n                break\n            case \"INTERSECT\":\n                window.app.query[message.data.query].splice(message.data.statement+1, 0, {$intersect: null})\n                break\n            case \"MINUS\":\n                window.app.query[message.data.query].splice(message.data.statement+1, 0, {$minus: null})\n                break\n            case \"UNIQUE\":\n                window.app.query[message.data.query].splice(message.data.statement+1, 0, {$unique: null})\n                break\n            case \"MATCH\":\n                window.app.query[message.data.query].splice(message.data.statement+1, 0, {$match: {}})\n                break\n            case \"PROJECT\":\n                window.app.query[message.data.query].splice(message.data.statement+1, 0, {$project: []})\n                break\n            case \"LIMIT\":\n                window.app.query[message.data.query].splice(message.data.statement+1, 0, {$limit: null})\n                break\n            case \"SAMPLE\":\n                window.app.query[message.data.query].splice(message.data.statement+1, 0, {$sample: null})\n                break\n            case \"OUT\":\n                window.app.query[message.data.query].splice(message.data.statement+1, 0, {$out: null})\n                break    \n        }\n        \n        buildQueryView()\n        \n    } \n    \n    \n    \n})\n\n// const tabs = [\n//     \"Query Builder\",\n//     \"Data\",\n//     \"Report\"\n// ]\n\n// const activeTab = \"\"\n\n// const activateTab = tab => {\n    \n// }\n\n// this.on({\n//     event: \"select-tab\",\n//     callback: tab => {\n//         console.log(tab.title)\n//     } \n// })\n\n\n// const tabsWidget = selectWidgets(\"exc82c574qg\").getInstance()\n// const navButtonWidget = selectWidgets(\"9moznwe4427\")\n    \nconst view = {\n    \"Query Builder\": [selectSections(\"qbluxwb1hp\")],\n    \"Data\": [selectSections(\"nhjrvywosye\")],\n    \"Report\": [selectSections(\"y94d6e9ms9s\")]\n}\n    \n    \nconst showView = name => {\n    _.keys(view).forEach(key => {\n        view[key].forEach( v => v.hide())    \n    })\n    view[name].forEach( v => v.show())\n}\n\n\n// showView(\"Query Builder\")\n\nthis.on({\n        event: \"select-tab\",\n        callback: async tab => {\n            if(!tab.title) return\n            if(window.app.currentView != tab.title){\n                window.app.currentView = tab.title\n                showView(window.app.currentView)\n                \n                switch (window.app.currentView) {\n                    case \"Query Builder\":\n                        setTimeout(() => {\n                            this.emit(\"apply-query\")\n                        }, 10)    \n                        break\n                    \n                    case \"Data\":\n                        await window.app.getData()\n                        break\n                    \n                    case \"Report\":\n                        break\n                }\n                \n                // if(!window.app.lock) {\n                //     await loadData()    \n                // }\n                \n            }\n        }\n    })\n\n\nthis.on({\n        event: \"set-limit\",\n        callback: async (sender, data) => {\n            if(window.app.lock) return\n            if (window.app.options.pagination.prevLimit != data) {\n                window.app.options.pagination.prevLimit = data || 10\n                console.log(\"setLimit\", data)\n                // window.app.options.eventData.limit = data || 10\n                if(!window.app.lock){\n                    await window.app.getData()    \n                }\n                \n            }\n        }\n    })\n\nthis.on({\n        event: \"prev-page\",\n        callback: async (sender, data) => {\n            let options = window.app.options\n            let skip = options.pagination.skip - options.pagination.limit\n            skip = (skip < 0) ? 0 : skip\n            if( skip != options.pagination.skip ){\n                options.pagination.skip = skip\n                // if(!window.app.lock) {\n                    await window.app.getData()\n                // }    \n            }\n        }\n    })\n    \n    \n    this.on({\n        event: \"first-page\",\n        callback: async (sender, data) => {\n            window.app.options.pagination.skip = 0\n                // if(!window.app.lock) {\n                    await window.app.getData()\n                // }    \n        }\n    })\n    \n    this.on({\n        event: \"last-page\",\n        callback: async (sender, data) => {\n            window.app.options.pagination.skip = Math.trunc(window.app.options.pagination.total/window.app.options.pagination.limit)*window.app.options.pagination.limit\n                // if(!window.app.lock) {\n                    await window.app.getData()\n                // }    \n        }\n    })\n    \n    this.on({\n        event: \"next-page\",\n        callback: async (sender, data) => {\n            let options = window.app.options\n            if(options.pagination.skip + options.pagination.limit > options.pagination.total) return\n            let skip = options.pagination.skip + options.pagination.limit\n            options.pagination.skip = skip\n            // if(!window.app.lock) {\n                await window.app.getData()\n            // }    \n        }\n    })\n    \n\n    \n    /////////////////////////////////////////////////////////////////////////\n         this.emit(\"select-tab\",{title:\"Query Builder\"})\n    \n    \n        \n        \n        \n        \n    }\n}) \n \n"},"id":"dycipquwppu","activated":false}]},"cpyl468daj":{"widgets":[{"type":"input-group-widget","name":"noname_clone_1imgqsalrki","icon":"mdi-card-bulleted-outline","options":{"widget":{"visible":true,"height":300}},"data":{"source":"embedded","embedded":{"rows":[{"decoration":{"classes":"d-flex align-center  pt-2","style":"border-top: 1px solid #dedede"},"cols":[{"type":"menu","data":{"items":[{"title":"SUBQUERY","event":"add-statement"},{"title":"UNION","event":"add-statement"},{"title":"INTERSECT","event":"add-statement"},{"title":"MINUS","event":"add-statement"},{"title":"UNIQUE","event":"add-statement"},{"title":"MATCH","event":"add-statement"},{"title":"PROJECT","event":"add-statement"},{"title":"LIMIT","event":"add-statement"},{"title":"SAMPLE","event":"add-statement"},{"title":"OUT","event":"add-statement"}]},"decoration":{"icon":"mdi-table-row-plus-after","iconOnly":true,"color":"secondary lighten-2","classes":"mr-1"}},{"type":"note","data":{"value":"FROM"},"decoration":{"classes":"subtitle-1 font-weight-bold ml-3 flex xs1 primary lighten-2 white--text pl-2"}},{"type":"select","data":{"label":"Collection","clearable":true,"value":"{{options.data.query[2][0].$from}}","items":"{{options.data.availableCollections}}"},"decoration":{"flat":true,"hideDetails":true,"outlined":true,"dense":true,"classes":"subtitle-2 ml-2"},"value":"{{options.data.query[0][0].$from}}"},{"type":"iconButton","data":{"event":"remove-statement"},"decoration":{"color":"warning","classes":"subtitle-2 ml-2","icon":"mdi-close-box-multiple-outline"}},{"type":"note","data":{"value":"Collection required"},"decoration":{"classes":"error--text subtitle-2 error-message px-2","style":"${`display: ${(!this.options.data.query[2][0].$from) ? \"inherit\" : \"none\"}`}"}}]}]},"script":""},"id":"1imgqsalrki","activated":false},{"type":"input-group-widget","name":"noname_clone_1imgqsalrki_clone_gijnpvdqwzi","icon":"mdi-card-bulleted-outline","options":{"widget":{"visible":true,"height":300}},"data":{"source":"embedded","embedded":{"rows":[{"decoration":{"classes":"d-flex align-center mt-2"},"cols":[{"type":"menu","data":{"items":[{"title":"UNION","event":"add-statement"},{"title":"INTERSECT","event":"add-statement"},{"title":"MINUS","event":"add-statement"},{"title":"UNIQUE","event":"add-statement"},{"title":"MATCH","event":"add-statement"},{"title":"PROJECT","event":"add-statement"},{"title":"LIMIT","event":"add-statement"},{"title":"SAMPLE","event":"add-statement"},{"title":"OUT","event":"add-statement"}]},"decoration":{"icon":"mdi-table-row-plus-after","iconOnly":true,"color":"secondary lighten-2","style":"padding-left:2em;"}},{"type":"note","data":{"value":"UNION"},"decoration":{"classes":"subtitle-2 flex xs1"},"value":"{{options.data.query[0][1].$union}}"},{"type":"select","data":{"label":"Collection","clearable":true,"value":"{{options.data.query[2][1].$union}}","items":"{{options.data.availableCollections}}"},"decoration":{"flat":true,"hideDetails":true,"outlined":true,"dense":true,"classes":"subtitle-2 ml-2"}},{"type":"iconButton","data":{"event":"remove-statement"},"decoration":{"color":"warning","classes":"subtitle-2 ml-2","icon":"mdi-close-box-outline"}},{"type":"note","data":{"value":"Collection required"},"decoration":{"classes":"error--text subtitle-2 error-message px-2","style":"${`display: ${(!this.options.data.query[2][1].$union) ? \"inherit\" : \"none\"}`}"}}]}]},"script":""},"id":"gijnpvdqwzi","activated":false},{"type":"input-group-widget","name":"noname_clone_1imgqsalrki_clone_gijnpvdqwzi_clone_eqyv5bh3dr","icon":"mdi-card-bulleted-outline","options":{"widget":{"visible":true,"height":300}},"data":{"source":"embedded","embedded":{"rows":[{"decoration":{"classes":"d-flex align-center mt-2"},"cols":[{"type":"menu","data":{"items":[{"title":"UNION","event":"add-statement"},{"title":"INTERSECT","event":"add-statement"},{"title":"MINUS","event":"add-statement"},{"title":"UNIQUE","event":"add-statement"},{"title":"MATCH","event":"add-statement"},{"title":"PROJECT","event":"add-statement"},{"title":"LIMIT","event":"add-statement"},{"title":"SAMPLE","event":"add-statement"},{"title":"OUT","event":"add-statement"}]},"decoration":{"icon":"mdi-table-row-plus-after","iconOnly":true,"color":"secondary lighten-2","style":"padding-left:2em;"}},{"type":"note","data":{"value":"INTERSECT"},"decoration":{"classes":"subtitle-2   flex xs1"},"value":"{{options.data.query[0][2].$intersect}}"},{"type":"select","data":{"label":"Collection","clearable":true,"value":"{{options.data.query[0][2].$intersect}}","items":"{{options.data.availableCollections}}"},"decoration":{"flat":true,"hideDetails":true,"outlined":true,"dense":true,"classes":"subtitle-2 ml-2"}},{"type":"iconButton","data":{"event":"remove-statement"},"decoration":{"color":"warning","classes":"subtitle-2 ml-2","icon":"mdi-close-box-outline"}},{"type":"note","data":{"value":"Collection required"},"decoration":{"classes":"error--text subtitle-2 error-message px-2","style":"${`display: ${(!this.options.data.query[0][2].$intersect) ? \"inherit\" : \"none\"}`}"}}]}]},"script":""},"id":"eqyv5bh3dr","activated":false},{"type":"input-group-widget","name":"noname_clone_1imgqsalrki_clone_gijnpvdqwzi_clone_eqyv5bh3dr_clone_ge2kfbypjg4","icon":"mdi-card-bulleted-outline","options":{"widget":{"visible":true,"height":300}},"data":{"source":"embedded","embedded":{"rows":[{"decoration":{"classes":"d-flex align-center mt-2"},"cols":[{"type":"menu","data":{"items":[{"title":"UNION","event":"add-statement"},{"title":"INTERSECT","event":"add-statement"},{"title":"MINUS","event":"add-statement"},{"title":"UNIQUE","event":"add-statement"},{"title":"MATCH","event":"add-statement"},{"title":"PROJECT","event":"add-statement"},{"title":"LIMIT","event":"add-statement"},{"title":"SAMPLE","event":"add-statement"},{"title":"OUT","event":"add-statement"}]},"decoration":{"icon":"mdi-table-row-plus-after","iconOnly":true,"color":"secondary lighten-2","style":"padding-left:2em;"}},{"type":"note","data":{"value":"MINUS"},"decoration":{"classes":"subtitle-2   flex xs1"},"value":"{{options.data.query[0][3].$minus}}"},{"type":"select","data":{"label":"Collection","clearable":true,"value":"{{options.data.query[0][3].$minus}}","items":"{{options.data.availableCollections}}"},"decoration":{"flat":true,"hideDetails":true,"outlined":true,"dense":true,"classes":"subtitle-2 ml-2"}},{"type":"iconButton","data":{"event":"remove-statement"},"decoration":{"color":"warning","classes":"subtitle-2 ml-2","icon":"mdi-close-box-outline"}},{"type":"note","data":{"value":"Collection required"},"decoration":{"classes":"error--text subtitle-2 error-message px-2","style":"${`display: ${(!this.options.data.query[0][3].$minus) ? \"inherit\" : \"none\"}`}"}}]}]},"script":""},"id":"ge2kfbypjg4","activated":false},{"type":"input-group-widget","name":"noname_clone_1imgqsalrki_clone_gijnpvdqwzi_clone_eqyv5bh3dr_clone_gbkd9b357ve","icon":"mdi-card-bulleted-outline","options":{"widget":{"visible":true,"height":300}},"data":{"source":"embedded","embedded":{"rows":[{"decoration":{"classes":"d-flex align-center mt-2"},"cols":[{"type":"menu","data":{"items":[{"title":"UNION","event":"add-statement"},{"title":"INTERSECT","event":"add-statement"},{"title":"MINUS","event":"add-statement"},{"title":"UNIQUE","event":"add-statement"},{"title":"MATCH","event":"add-statement"},{"title":"PROJECT","event":"add-statement"},{"title":"LIMIT","event":"add-statement"},{"title":"SAMPLE","event":"add-statement"},{"title":"OUT","event":"add-statement"}]},"decoration":{"icon":"mdi-table-row-plus-after","iconOnly":true,"color":"secondary lighten-2","style":"padding-left:2em;"}},{"type":"note","data":{"value":"UNIQUE"},"decoration":{"classes":"subtitle-2 flex xs1"}},{"type":"select","data":{"label":"Label","clearable":true,"value":"{{options.data.query[0][4].$unique}}","items":"{{options.data.availableLabels}}"},"decoration":{"flat":true,"hideDetails":true,"outlined":true,"dense":true,"classes":"subtitle-2 ml-2"}},{"type":"iconButton","data":{"event":"remove-statement"},"decoration":{"color":"warning","classes":"subtitle-2 ml-2","icon":"mdi-close-box-outline"}},{"type":"note","data":{"value":"Label required"},"decoration":{"classes":"error--text subtitle-2 error-message px-2","style":"${`display: ${(!this.options.data.query[0][4].$unique) ? \"inherit\" : \"none\"}`}"}}]}]},"script":""},"id":"gbkd9b357ve","activated":false},{"type":"input-group-widget","name":"noname_clone_1imgqsalrki_clone_gijnpvdqwzi_clone_eqyv5bh3dr_clone_gbkd9b357ve_clone_hz3w7raswo","icon":"mdi-card-bulleted-outline","options":{"widget":{"visible":true,"height":300}},"data":{"source":"embedded","embedded":{"rows":[{"decoration":{"classes":"d-flex align-center mt-2"},"cols":[{"type":"menu","data":{"items":[{"title":"UNION","event":"add-statement"},{"title":"INTERSECT","event":"add-statement"},{"title":"MINUS","event":"add-statement"},{"title":"UNIQUE","event":"add-statement"},{"title":"MATCH","event":"add-statement"},{"title":"PROJECT","event":"add-statement"},{"title":"LIMIT","event":"add-statement"},{"title":"SAMPLE","event":"add-statement"},{"title":"OUT","event":"add-statement"}]},"decoration":{"icon":"mdi-table-row-plus-after","iconOnly":true,"color":"secondary lighten-2","style":"padding-left:2em;"}},{"type":"note","data":{"value":"PROJECT"},"decoration":{"classes":"subtitle-2 flex xs1"},"value":"{{options.data.query[0][5].$project}}"},{"type":"select","data":{"label":"Labels","clearable":true,"multiple":true,"value":"{{options.data.query[0][1].$project}}","items":"{{options.data.availableLabels}}"},"decoration":{"flat":true,"hideDetails":true,"outlined":true,"dense":true,"classes":"subtitle-2 ml-2"}},{"type":"iconButton","data":{"event":"remove-statement"},"decoration":{"color":"warning","classes":"subtitle-2 ml-2","icon":"mdi-close-box-outline"}},{"type":"note","data":{"value":"Labels required"},"decoration":{"classes":"error--text subtitle-2 error-message px-2","style":"${`display: ${(!this.options.data.query[0][1].$project.length > 0) ? \"inherit\" : \"none\"}`}"}}]}]},"script":""},"id":"hz3w7raswo","activated":false},{"type":"input-group-widget","name":"noname_clone_1imgqsalrki_clone_gijnpvdqwzi_clone_eqyv5bh3dr_clone_gbkd9b357ve_clone_xhp8yakkw8r","icon":"mdi-card-bulleted-outline","options":{"widget":{"visible":true,"height":300}},"data":{"source":"embedded","embedded":{"rows":[{"decoration":{"classes":"d-flex align-center mt-2"},"cols":[{"type":"menu","data":{"items":[{"title":"UNION","event":"add-statement"},{"title":"INTERSECT","event":"add-statement"},{"title":"MINUS","event":"add-statement"},{"title":"UNIQUE","event":"add-statement"},{"title":"MATCH","event":"add-statement"},{"title":"PROJECT","event":"add-statement"},{"title":"LIMIT","event":"add-statement"},{"title":"SAMPLE","event":"add-statement"},{"title":"OUT","event":"add-statement"}]},"decoration":{"icon":"mdi-table-row-plus-after","iconOnly":true,"color":"secondary lighten-2","style":"padding-left:2em;"}},{"type":"note","data":{"value":"OUT"},"decoration":{"classes":"subtitle-2  flex xs1"},"value":"{{options.data.query[0][8].$out}}"},{"type":"text","data":{"event":"set-out-collection","label":"Collection","value":"{{options.data.query[1][1].$out}}"},"decoration":{"flat":true,"hideDetails":true,"outlined":true,"dense":true,"classes":"subtitle-2 ml-2"}},{"type":"iconButton","data":{"event":"remove-statement"},"decoration":{"color":"warning","classes":"subtitle-2 ml-2","icon":"mdi-close-box-outline"}},{"type":"note","data":{"value":"Valid name of temporary collection required"},"decoration":{"classes":"error--text subtitle-2 error-message px-2","style":"${`display: ${(!this.options.data.query[1][1].$out) ? \"inherit\" : \"none\"}`}"}}]}]},"script":""},"id":"xhp8yakkw8r","activated":false},{"type":"input-group-widget","name":"noname_clone_1imgqsalrki_clone_gijnpvdqwzi_clone_eqyv5bh3dr_clone_gbkd9b357ve_clone_xhp8yakkw8r_clone_a0nrc6pf59f_clone_95l4wqplwo8","icon":"mdi-card-bulleted-outline","options":{"widget":{"visible":true,"height":300}},"data":{"source":"embedded","embedded":{"rows":[{"decoration":{"classes":"d-flex align-center mt-2"},"cols":[{"type":"menu","data":{"items":[{"title":"UNION","event":"add-statement"},{"title":"INTERSECT","event":"add-statement"},{"title":"MINUS","event":"add-statement"},{"title":"UNIQUE","event":"add-statement"},{"title":"MATCH","event":"add-statement"},{"title":"PROJECT","event":"add-statement"},{"title":"LIMIT","event":"add-statement"},{"title":"SAMPLE","event":"add-statement"},{"title":"OUT","event":"add-statement"}]},"decoration":{"icon":"mdi-table-row-plus-after","iconOnly":true,"color":"secondary lighten-2","style":"padding-left:2em;"}},{"type":"note","data":{"value":"SAMPLE"},"decoration":{"classes":"subtitle-2  flex xs1"}},{"type":"text","data":{"label":"Count","value":"{{options.data.query[0][8].$sample}}"},"decoration":{"flat":true,"hideDetails":true,"outlined":true,"dense":true,"classes":"subtitle-2 ml-2"}},{"type":"iconButton","data":{"event":"remove-statement"},"decoration":{"color":"warning","classes":"subtitle-2 ml-2","icon":"mdi-close-box-outline"}},{"type":"note","data":{"value":"Positive integer required"},"decoration":{"classes":"error--text subtitle-2 error-message px-2","style":"${`display: ${(!this.options.data.query[0][0].$from) ? \"inherit\" : \"none\"}`}"}}]}]},"script":""},"id":"95l4wqplwo8","activated":false},{"type":"input-group-widget","name":"noname_clone_1imgqsalrki_clone_gijnpvdqwzi_clone_eqyv5bh3dr_clone_gbkd9b357ve_clone_xhp8yakkw8r_clone_a0nrc6pf59f_clone_95l4wqplwo8_clone_wrk3vumfwi","icon":"mdi-card-bulleted-outline","options":{"widget":{"visible":true,"height":300}},"data":{"source":"embedded","embedded":{"rows":[{"decoration":{"classes":"d-flex align-center mt-2"},"cols":[{"type":"menu","data":{"items":[{"title":"UNION","event":"add-statement"},{"title":"INTERSECT","event":"add-statement"},{"title":"MINUS","event":"add-statement"},{"title":"UNIQUE","event":"add-statement"},{"title":"MATCH","event":"add-statement"},{"title":"PROJECT","event":"add-statement"},{"title":"LIMIT","event":"add-statement"},{"title":"SAMPLE","event":"add-statement"},{"title":"OUT","event":"add-statement"}]},"decoration":{"icon":"mdi-table-row-plus-after","iconOnly":true,"color":"secondary lighten-2","style":"padding-left:2em;"}},{"type":"note","data":{"value":"LIMIT"},"decoration":{"classes":"subtitle-2  flex xs1"}},{"type":"text","data":{"label":"Count","value":"{{options.data.query[0][8].$limit}}"},"decoration":{"flat":true,"hideDetails":true,"outlined":true,"dense":true,"classes":"subtitle-2 ml-2"}},{"type":"iconButton","data":{"event":"remove-statement"},"decoration":{"color":"warning","classes":"subtitle-2 ml-2","icon":"mdi-close-box-outline"}},{"type":"note","data":{"value":"Positive integer required"},"decoration":{"classes":"error--text subtitle-2 error-message px-2","style":"${`display: ${(Number.parseInt(this.options.data.query[0][8].$limit) <= 0 || Number.isNaN(Number.parseInt(this.options.data.query[0][8].$limit))) ? \"inherit\" : \"none\"}`}"}}]}]},"script":""},"id":"wrk3vumfwi","activated":false},{"type":"input-group-widget","name":"noname_clone_1imgqsalrki_clone_gijnpvdqwzi_clone_eqyv5bh3dr_clone_gbkd9b357ve_clone_mkobjn8slf","icon":"mdi-card-bulleted-outline","options":{"widget":{"visible":true,"height":300}},"data":{"source":"embedded","embedded":{"rows":[{"decoration":{"classes":"d-flex align-center mt-2"},"cols":[{"type":"menu","data":{"items":[{"title":"UNION","event":"add-statement"},{"title":"INTERSECT","event":"add-statement"},{"title":"MINUS","event":"add-statement"},{"title":"UNIQUE","event":"add-statement"},{"title":"MATCH","event":"add-statement"},{"title":"PROJECT","event":"add-statement"},{"title":"LIMIT","event":"add-statement"},{"title":"SAMPLE","event":"add-statement"},{"title":"OUT","event":"add-statement"}]},"decoration":{"icon":"mdi-table-row-plus-after","iconOnly":true,"color":"secondary lighten-2","style":"padding-left:2em;"}},{"type":"note","data":{"value":"MATCH"},"decoration":{"classes":"subtitle-2 flex xs1"}},{"type":"select","data":{"event":"select-label","label":"Label","clearable":true,"value":"{{options.data.MATCH.var}}","items":"{{options.data.availableLabels}}"},"decoration":{"flat":true,"hideDetails":true,"outlined":true,"dense":true,"classes":"subtitle-2 ml-2"}},{"type":"select","data":{"label":"Operation","clearable":true,"value":"{{options.data.MATCH.op}}","items":"${app.getOperations(this.options.data.MATCH.var)}"},"decoration":{"flat":true,"hideDetails":true,"outlined":true,"dense":true,"classes":"subtitle-2 ml-2"}},{"type":"select","data":{"label":"Values","clearable":true,"multiple":true,"value":"{{options.data.coll}}","items":"${app.query.collections}"},"decoration":{"flat":true,"hideDetails":true,"outlined":true,"dense":true,"classes":"subtitle-2 ml-2"}},{"type":"text","data":{"label":"Value","value":"{{options.data}}"},"decoration":{"flat":true,"hideDetails":true,"outlined":true,"dense":true,"classes":"subtitle-2 ml-2"}},{"type":"iconButton","data":{"event":"remove-statement"},"decoration":{"color":"warning","classes":"subtitle-2 ml-2","icon":"mdi-close-box-outline"}},{"type":"note","data":{"value":"Label required"},"decoration":{"classes":"error--text subtitle-2 error-message px-2","style":"${`display: ${(app.labelRequired(this.options.data.query[0][1].$match)}`}"}},{"type":"note","data":{"value":"Operation required"},"decoration":{"classes":"error--text subtitle-2 error-message px-2","style":"${`display: ${(!this.options.data.query[0][0].$from) ? \"inherit\" : \"none\"}`}"}},{"type":"note","data":{"value":"Value required"},"decoration":{"classes":"error--text subtitle-2 error-message px-2","style":"${`display: ${(!this.options.data.query[0][0].$from) ? \"inherit\" : \"none\"}`}"}}]}]},"script":""},"id":"mkobjn8slf","activated":false}]},"rujgoev5vsm":{"widgets":[{"type":"data-table-widget","name":"noname","icon":"mdi-grid","options":{"widget":{"visible":true},"style":"\n  widget-style {\n    border: 1px solid #bdbdbd;\n    margin:0 5px;\n  }\n"},"data":{"source":"embedded","embedded":{"decoration":{"dense":true,"loading":false},"header":{"decoration":{"class":"body-1 primary--text"},"items":"{{options.data.header}}"},"rows":"{{options.data.collection}}"},"script":""},"id":"ovmpjavhj7s","activated":false},{"type":"input-group-widget","name":"noname","icon":"mdi-card-bulleted-outline","options":{"widget":{"visible":true,"height":300}},"data":{"source":"embedded","embedded":{"items":[{"label":"10","value":10},{"label":"20","value":20},{"label":"30","value":30},{"label":"50","value":50},{"label":"70","value":70}],"rows":[{"decoration":{"classes":"d-flex align-center justify-end py-1 mt-1"},"cols":[{"type":"select","data":{"event":"set-limit","value":"{{options.data.limit}}","label":"Rows per page","itemText":"label","itemValue":"value","items":"{{options.items}}","multiple":false,"clearable":false},"decoration":{"classes":"flex xs2 mr-2","outlined":true,"dense":true,"flat":true}},{"type":"iconButton","data":{"event":"first-page"},"decoration":{"icon":"mdi-chevron-double-left","color":"primary lighten-1","classes":"mx-1"}},{"type":"iconButton","data":{"event":"prev-page"},"decoration":{"icon":"mdi-chevron-left","color":"primary lighten-1","classes":"mx-1"}},{"type":"note","data":{"value":"{{options.data.pagePosition}}"},"decoration":{"classes":"secondary--text ml-4 mr-3 body-2"}},{"type":"iconButton","data":{"event":"next-page"},"decoration":{"icon":"mdi-chevron-right","color":"primary lighten-1","classes":"mx-1"}},{"type":"iconButton","data":{"event":"last-page"},"decoration":{"icon":"mdi-chevron-double-right","color":"primary lighten-1","classes":"mx-1"}}]}]},"script":""},"id":"7ea05p16tei","activated":false}]},"r2uxttl92x":{"widgets":[{"type":"input-group-widget","name":"QUERY_BUILDER","icon":"mdi-card-bulleted-outline","options":{"widget":{"visible":true,"height":300}},"data":{"source":"embedded","embedded":{"rows":[]},"script":""},"id":"zpyh6ysue5l","activated":false}]},"2060ine4x48":{"widgets":[{"type":"html-widget","name":"noname_clone_fuf7r0c9ykm","icon":"mdi-language-html5","options":{"widget":{"visible":true}},"data":{"source":"embedded","embedded":"<div> report view</div>","script":""},"id":"fuf7r0c9ykm","activated":false}]}},"id":"1","title":"1","url":"http://localhost:8080/design/TEST%20MONGO#/1"}],"keywords":[],"collaborations":[],"_id":"63ce428bac2fa551f4b987a6","title":"TEST MONGO","description":"Djvue app template. If you is author or collaborator use design tools for modify it","isPublished":true,"name":"TEST MONGO","icon":"./img/djvue.png","skin":{"holders":{"AppHeader":{"widgets":[{"type":"mediator-widget","name":"noname","icon":"mdi-language-javascript","options":{"widget":{"visible":true}},"data":{"script":"const DB_SETTINGS = {\n    db: {\n        url: \"mongodb://localhost:27017\",\n        // url: \"mongodb+srv://jace:jace@jace.llb8spm.mongodb.net?retryWrites=true&w=majority\",\n        name: \"sparrow\",\n        labelingCollection: \"harvest1\",\n        metadataCollection: \"harvest1-metadata\",\n        historyCollection: \"harvest1-history\",\n        grantCollection: \"app-grant\"\n    },\n    \n    pagination:{\n        skip: 0,\n        limit: 10\n    }\n}   \n\n\nlet scripts = this.api.selectWidgets(\"irax2gi7nic\").config.scripts\nlet getScript = name => _.find(scripts, s => s.name == name).script\n    \n\nwindow.app = {\n    options: DB_SETTINGS,\n    operationItems:{\n        $from:{\n            default:[\"$union\", \"$intersection\",\"$minus\", \"$unique-by\"]\n        }\n    }\n}\n\n\n// const loadCollections = async () => {\n//     let response = await this.api.runDps( getScript(\"LOAD_COLLECTIONS\"), {options: window.app.options} )\n//     console.log(response)\n//     window.app.collections = response.data\n// }\n\nconst loadMetadata = async () => {\n            let response  = await this.api.runDps(getScript(\"GET_METADATA\"), {options: window.app.options})\n            let metadata = {} \n            // console.log(\"METADATA\", response.data)\n            response.data\n                .filter( m => m.label)\n                .forEach( item => {\n                    metadata[item.name] = item\n                })\n            window.app.metadata = metadata\n            window.app.availableLabels = response.data\n                .filter( m => m.label)\n                .map( m => m.name)\n        }\n\n\nconst showInTable = data => {\n        let tableWidget = selectWidgets(\"ovmpjavhj7s\")\n        setTimeout(() => {\n            tableWidget.update({ data }, { override: \"options.data\" })\n        }, 10)\n    }\n    \nconst tableLoading = available => {\n        let tableWidget = selectWidgets(\"ovmpjavhj7s\")\n        setTimeout(() => {\n            tableWidget.getInstance().options.decoration.loading = available\n        }, 10)\n    }\n\n\nconst updatePagination = data => {\n        setTimeout(() => {\n            selectWidgets(\"7ea05p16tei\").update({ data }, { override: \"options.data\" })\n            this.$nextTick(() => {\n                window.app.lock = false\n            })\n        }, 10)\n    }\n    \n\nwindow.app.getData = async () => {\n    tableLoading(true)\n    window.app.lock = true\n    let response  = await this.api.runDps(getScript(\"GET_DATA\"), {options: window.app.options, script: window.app.query})\n    console.log(\"LOAD DATA\", response.data)\n    showInTable(response.data)\n    window.app.options.pagination = _.extend({}, window.app.options.pagination, response.data.pagination)\n    updatePagination(window.app.options.pagination)\n    tableLoading(false)\n}\n\n\nconst bootstrap = async () => {\n    // await loadCollections()\n    await loadMetadata()\n    \n    this.emit(\"start\")\n} \n\nbootstrap()"},"id":"s8xvinkmnxq","activated":false},{"type":"dps-suite-widget","name":"noname","icon":"mdi-card-text-outline","options":{"widget":{"visible":true}},"scripts":[{"name":"LOAD_COLLECTIONS","script":"\n/**\n **\n **     DATA PROCESSING SCRIPT: LOAD_COLLECTIONS\n **     SERVICE: \n **\n **/\n\n<?javascript\n    $scope.options = {\n        db: {\n            url: \"mongodb://localhost:27017\",\n            // url: \"mongodb+srv://jace:jace@jace.llb8spm.mongodb.net?retryWrites=true&w=majority\",\n            name: \"sparrow\",\n            labelingCollection: \"harvest1\",\n            metadataCollection: \"harvest1-metadata\",\n            historyCollection: \"harvest1-history\",\n            grantCollection: \"app-grant\"\n        }\n    }    \n\n?>\n\nservice.mongodb.collections(\n    at: <? $scope.options.db.url ?>,\n    from: <? $scope.options.db.name ?>\n)\nset(\"res\")\n\n<?javascript\n    $scope.res = $scope.res.map( c => c.name)\n?>\n\nreturn(\"res\")"},{"name":"GET_METADATA","script":"\nservice.mongodb.aggregate(\n    at: <? $scope.options.db.url ?>,\n    from: <? `${$scope.options.db.name}.${$scope.options.db.metadataCollection}` ?>,\n    query: <? \n        [   \n            {\n                $project:{ _id: 0 }\n            }\n                    \n        ] \n    ?> \n)\n\n"},{"name":"GET_DATA","script":"\n/**\n **\n **     DATA PROCESSING SCRIPT: GET_DATA\n **     SERVICE: \n **\n **/\n\n//  <?javascript\n//     $scope.options = {\n//         db: {\n//                 url: \"mongodb://localhost:27017\",\n//                 // url: \"mongodb+srv://jace:jace@jace.llb8spm.mongodb.net?retryWrites=true&w=majority\",\n//                 name: \"sparrow\",\n//                 labelingCollection: \"harvest1\",\n//                 metadataCollection: \"harvest1-metadata\",\n//                 historyCollection: \"harvest1-history\",\n//                 grantCollection: \"app-grant\"\n//         },\n            \n//         pagination:{\n//             skip: 2,\n//             limit: 3\n//         }\n//     }\n\n//     $scope.script = [\n//         [\n//             {\n//                 $from: \"harvest1\"\n//             },\n//             {\n//                 $match: {\n//                     label: \"Gender\",\n//                     operation: \"$not-in\",\n//                     value: [\"Male\"]\n//                 }\n//             },\n//             {\n//                 $limit: 5\n//             },\n//             {\n//                 $out: \"TO-FEMALE\"\n//             }\n//         ],\n//         [\n//             {\n//                 $from: \"harvest1\"\n//             },\n//             {\n//                 $match: {\n//                     label: \"Gender\",\n//                     operation: \"$in\",\n//                     value: [\"Male\"]\n//                 }\n//             },\n//             {\n//                 $limit: 6\n//             },\n//             {\n//                 $out: \"TO-MALE\"\n//             }\n//         ],\n//         [\n//             {\n//                 $from: \"TO-FEMALE\"\n//             },\n//             {\n//                 $union: \"TO-MALE\"\n//             },    \n//             {\n//                 $project:[\n//                     \"id\",\n//                     \"Gender\",\n//                     \"Examination ID\"\n//                 ]\n//             }\n//         ],\n        \n//     ]\n//  ?>\n\n\nservice.mongodb.script(\n    at: <? $scope.options.db.url ?>,\n    db: <? $scope.options.db.name ?>,\n    script: <? $scope.script ?>,\n    pagination: <? $scope.options.pagination ?>\n)\n"}],"data":{"source":"embedded","embedded":"<h2 color=\"#eee\"><center>not configured<center></h2><p>Use options dialog for configure this widget</p>","script":""},"id":"irax2gi7nic","activated":false}]},"AppFooter":{"widgets":[]}}},"dpsURL":"","theme":{"primary":"#3C5F70","accent":"#615B62","secondary":"#1B272C","success":"#008048","info":"#00D5FF","warning":"#FB7F00","error":"#bc3442"},"owner":"601aab8751c7780004a50099","createdAt":"2022-11-08T14:51:09.801Z","updatedAt":"2023-02-12T20:41:25.087Z","__v":0,"clientOptions":null}